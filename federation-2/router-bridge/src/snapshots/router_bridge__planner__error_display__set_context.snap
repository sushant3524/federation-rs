---
source: router-bridge/src/planner.rs
expression: "serde_json::to_string_pretty(&planner.plan(\"query Query {\n                        t {\n                          id\n                          u {\n                            field\n                          }\n                        }\n                      }\".to_string(),\n                                None,\n                                PlanOptions {\n                                    ..Default::default()\n                                }).await.unwrap().data.unwrap()).unwrap()"
---
{
  "queryPlan": {
    "kind": "QueryPlan",
    "node": {
      "kind": "Sequence",
      "nodes": [
        {
          "kind": "Fetch",
          "serviceName": "Subgraph1",
          "variableUsages": [],
          "operation": "query Query__Subgraph1__0{t{prop id u{__typename id}}}",
          "operationKind": "query",
          "operationName": "Query__Subgraph1__0"
        },
        {
          "kind": "Flatten",
          "path": [
            "t",
            "u"
          ],
          "node": {
            "kind": "Fetch",
            "serviceName": "Subgraph1",
            "requires": [
              {
                "kind": "InlineFragment",
                "typeCondition": "U",
                "selections": [
                  {
                    "kind": "Field",
                    "name": "__typename"
                  },
                  {
                    "kind": "Field",
                    "name": "id"
                  }
                ]
              }
            ],
            "variableUsages": [
              "contextualArgument_1_0"
            ],
            "operation": "query Query__Subgraph1__1($representations:[_Any!]!$contextualArgument_1_0:String){_entities(representations:$representations){...on U{field(a:$contextualArgument_1_0)}}}",
            "operationKind": "query",
            "operationName": "Query__Subgraph1__1",
            "contextRewrites": [
              {
                "kind": "KeyRenamer",
                "path": [
                  "..",
                  "... on T",
                  "prop"
                ],
                "renameKeyTo": "contextualArgument_1_0"
              }
            ]
          }
        }
      ]
    }
  },
  "formattedQueryPlan": "QueryPlan {\n  Sequence {\n    Fetch(service: \"Subgraph1\") {\n      {\n        t {\n          prop\n          id\n          u {\n            __typename\n            id\n          }\n        }\n      }\n    },\n    Flatten(path: \"t.u\") {\n      Fetch(service: \"Subgraph1\") {\n        {\n          ... on U {\n            __typename\n            id\n          }\n        } =>\n        {\n          ... on U {\n            field(a: $contextualArgument_1_0)\n          }\n        }\n      },\n    },\n  },\n}"
}
